<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script type="text/javascript" src="/org.dojotoolkit/dojo/dojo.js.uncompressed.js"></script>
	<script type="text/javascript" src="/orion/plugin.js"></script>
	<script>
		window.onload = function() {
			var provider = new eclipse.PluginProvider();
			var serviceImpl = {
				getUser : function() {
					
					return dojo.xhrPost({
						url : "/login",
						headers : {
							"Orion-Version" : "1"
						},
						handleAs : "json",
						timeout : 15000,
						load : function(jsonData, ioArgs) {
							if(JSON.stringify(jsonData) !== localStorage.getItem("FORMOpenIdUser"))
								localStorage.setItem("FORMOpenIdUser",  JSON.stringify(jsonData));
							return jsonData;
						},
						error : function(response, ioArgs) {
							return response;
						}
					});
					
				},
			
				logout : function() {
				/* don't wait for the login response, notify anyway */
				notify = true;
				dojo.xhrPost({
					url : "/logout",
					headers : {
						"Orion-Version" : "1"
					},
					handleAs : "json",
					timeout : 15000,
					load : function(jsonData, ioArgs) {
						localStorage.removeItem("FORMOpenIdUser");
						return jsonData;
					},
					error : function(response, ioArgs) {
						return response;
					}
				});
			},
			
			getAuthForm : function(){
				return '/mixloginstatic/LoginWindow.html';
			},
			
			login : function(){
				window.open(authService.getAuthForm(), 'Login Window', 'width=400, height=200');
			},
			
			getKey : function(){
				return "FORMOpenIdUser";
			}
			
			};
			var serviceProps = {
				name : "FORM+OpenId",
			};
			provider.registerServiceProvider("orion.core.auth", serviceImpl, serviceProps);
			provider.connect();
		};
	</script>
</head>
<body>
</body>
</html>